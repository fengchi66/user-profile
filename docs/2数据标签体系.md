# 数据标签体系

>用户画像作为当下描述分析用户、运营营销的重要工具，被全部互联网人熟知，用户画像的定义并不复杂，是系统通过用户自行上传或埋点上报收集记录了用户大量信息，为便于各业务应用，将这些信息进行沉淀、加工和抽象，形成一个以用户标志为主 key 的`标签树`，用于全面刻画用户的属性和行为信息，这就是用户画像。

## 数据架构

![image-20210530220015071](2数据标签体系.assets/image-20210530220015071.png)

- 下面虚线框为常见的数据仓库ETL加工流程，将每天的业务数据、埋点数据、日志数据经过数仓建模处理，加工到对应的数仓ODS、DWD、DWS层。
- 中间虚线部分为用户画像建模的主要环节，画像数据不是产生数据的源头，而是对数仓的ODS、DWD层等数据做二次建模加工，将用户标签计算结果写入到Hive，最后基于不同的数据使用场景，进一步将数据同步到Mysql、HBase、ES等数据库中。
  - Hive：存储用户标签计算结果、用户人群计算结果、用户特征计算结果。
  - Mysql：存储标签元数据
  - Hbase：存储线上接口实时调用类数据
  - ES：支持海量数据的准实时查询分析，用户存储用户人群计算、用户群透视分析所需的用户标签数据。
- 用户标签数据在Hive中加工完成后，部分标签导入到提供BI展示、多维透视分析数据、圈人服务的分析数据库中，分析场景ClickHouse应该相对于es是更好的选择；另一部分同步到HBase中提供线上个性化推荐服务。

## 标签类型及命名方式

### 标签类型

一个比较成熟的画像系统，会有成千上百的标签，这些标签的生产不是一次完成的，而是随着业务的发展需要，逐步补充完善，最终呈现在大家眼前的就是一棵庞大的标签树。

跟自然界的树木一样，要想长得茁壮参天，必须有一个稳定的根基和合理的结构，用户画像的构建也是一样的，前期最重要的仍然是搭好画像骨架，确保后续的发展过程中，依然保持清晰的结构和高延展性。相反的，如果一开始为了抢时间，将大量标签无序的堆在线上，后期管理和使用的难度会迅速凸显出来，重构的代价巨大。

上面说到，一个好的标签树结构要满足两个条件，`高概括性`和`强延展性`，`高概括性`意味着结构体系能够很好的包含一个用户的基本属性和产品交互的相关行为，同时对于业务重点单独强调，没有遗漏；`强延展性`意味着结构全面的同时也有一定的抽象概括能力，保证新增的标签可以很好的找到对应的分类，整个体系不会过于收敛局限。

从对用户打标签的方式来看，可以分为一下三种类型的标签：

- 统计类标签：这类标签是最为基础也最为常见的标签类型，例如对于某个用户来说，他的性别、年龄、城市、星座、近7日活跃时长、近7日活跃天数、近7日活跃次数等字段可以从用户注册数据、用户访问、消费类数据中统计得出。该类标签构成了用户画像的基础；
- 规则类标签：该类标签基于用户行为及确定的规则产生。例如对平台上“消费活跃”用户这一口径的定义为近30天交易次数>=2。在实际开发画像的过程中，由于运营人员对业务更为熟悉、而数据人员对数据的结构、分布、特征更为熟悉，因此规则类标签的规则确定由运营人员和数据人员共同协商确定；
- 机器学习挖掘类标签：该类标签通过数据挖掘产生，应用在对用户的某些属性或某些行为进行预测判断。例如根据一个用户的行为习惯判断该用户是男性还是女性，根据一个用户的消费习惯判断其对某商品的偏好程度。该类标签需要通过算法挖掘产生。

在项目工程实践中，一般统计类和规则类的标签即可以满足应用需求，开发中占有较大比例。机器学习挖掘类标签多用于预测场景，如判断用户性别是男是女，判断用户购买商品偏好、判断用户流失意向等。一般地机器学习标签开发周期较长，耗费开发成本较大，因此其开发所占比例较小。

### 标签命名方式

| 标签主题                            | 标签类型            | 开发方式            | 是否互斥关系      | 用户维度                |
| ----------------------------------- | ------------------- | ------------------- | ----------------- | ----------------------- |
| A：用户属性 B：用户行为 C：用户消费 | 1：分类型 2：统计型 | 1：统计型 2：算法型 | 1：互斥 2：非互斥 | D：device_id U：user_id |

- 标签主题：用于刻画属于那种类型的标签，如用户属性、用户行为、用户消费、风险控制等多种类型，可用A、B、C、D等字母表示各标签主题；
- 标签类型：标签类型可划为分类型和统计型这两种类型，其中分类型用于刻画用户属于哪种类型，如是男是女、是否是会员、是否已流失等标签，统计型标签用于刻画统计用户的某些行为次数，如历史购买金额、优惠券使用次数、近30日登陆次数等标签，`这类标签都需要对应一个用户相应行为的权重次数`；
- 开发方式：开发方式可分为统计型开发和算法型开发两大开发方式。其中统计型开发可直接从数据仓库中各主题表建模加工而成，算法型开发需要对数据做机器学习的算法处理得到相应的标签；
- 是否互斥标签：对应同一级类目下（如一级标签、二级标签），各标签之间的关系是否为互斥，可将标签划分为互斥关系和非互斥关系。例如对于男、女标签就是互斥关系，同一个用户不是被打上男性标签就是女性标签，对于高活跃、中活跃、低活跃标签也是互斥关系；
- 用户维度：用于刻画该标签是打在用户唯一标识（userid）上，还是打在用户使用的设备（deviceid）上。可用U、D等字母分别标识userid和deviceid维度。

### 标签命名

案例：A111U001_001

对于用户是男是女这个标签，标签主题是用户属性，标签类型属于分类型，开发方式为统计型，为互斥关系，用户维度为userid。这样给男性用户打上标签“A111U001_001”，女性用户打上标签“A111U001_002”，其中“A111U”为上面介绍的命名方式，“001”为一级标签的id，后面对于用户属性维度的其他一级标签可用“002”、“003”等方式追加命名，“_”后面的“001”和“002”为该一级标签下的标签明细，如果是划分高、中、低活跃用户的，对应一级标签下的明细可划分为“001”、“002”、“003”。

## 标签维度(主题)

从标签组织的维度来看，可以分为下面几种：

- 用户属性类
- 用户行为类
- 用户消费类
- 风险控制类
- 社交属性类

### 用户属性维度

用户属性是刻画用户的基础。常见的用户属性指标包括：用户的年龄、性别、安装、注册时间、城市、省份、活跃登陆地、历史购买状态、历史购买金额等。用户属性维度标签简历以后可以提供客服电话服务，为运营人员了解用户基本情况提供帮助等。

#### 常见用户属性

常见的用户属性维度标签，所有标签参考excel表格：

| 标签id       | 标签名称                   | 标签汉语     | 序号 | 标签主题 | 一级标签id | 一级标签   | 二级标签id | 二级标签 | 标签类型      | 开发方式      |
| ------------ | -------------------------- | ------------ | ---- | -------- | ---------- | ---------- | ---------- | -------- | ------------- | ------------- |
|              |                            |              |      |          |            |            |            |          | 1-分类 2 统计 | 1 算法 2 统计 |
| A111H001_001 | male                       | 男           | 1    | 用户属性 | 1          | 性别       |            |          | 1             | 1             |
| A111H001_002 | famale                     | 女           | 2    | 用户属性 | 1          | 性别       |            |          | 1             | 1             |
| A121H002_001 | beijing                    | 北京         | 1    | 用户属性 | 2          | 省份       |            |          | 1             | 2             |
| A121H002_002 | hebei                      | 河北         | 2    | 用户属性 | 2          | 省份       |            |          | 1             | 2             |
| A121H002_003 | henan                      | 河南         | 3    | 用户属性 | 2          | 省份       |            |          | 1             | 2             |
| A121H002_004 | anhui                      | 安徽         | 4    | 用户属性 | 2          | 省份       |            |          | 1             | 2             |
| A121H002_005 | jiangsu                    | 江苏         | 5    | 用户属性 | 2          | 省份       |            |          | 1             | 2             |
| A121H002_006 | zhejiang                   | 浙江         | 6    | 用户属性 | 2          | 省份       |            |          | 1             | 2             |
| A121H002_007 | guangdong                  | 广东         | 7    | 用户属性 | 2          | 省份       |            |          | 1             | 2             |
| A121H002_008 | fujian                     | 福建         | 8    | 用户属性 | 2          | 省份       |            |          | 1             | 2             |
| A121H002_009 | hubei                      | 湖北         | 9    | 用户属性 | 2          | 省份       |            |          | 1             | 2             |
| A121H002_010 | shanghai                   | 上海         | 10   | 用户属性 | 2          | 省份       |            |          | 1             | 2             |
| A121H002_011 | …                          | …            | …    | 用户属性 | 2          | 省份       |            |          | 1             | 2             |
| A121H003_001 | have cars                  | 有车         | 1    | 用户属性 | 3          | 汽车资产   |            |          | 1             | 2             |
| A121H003_002 | no cars                    | 无车         | 2    | 用户属性 | 3          | 汽车资产   |            |          | 1             | 2             |
| A121H004_001 | have kids                  | 有小孩       | 1    | 用户属性 | 4          | 是否有小孩 |            |          | 1             | 2             |
| A121H004_002 | no kids                    | 无小孩       | 2    | 用户属性 | 4          | 是否有小孩 |            |          | 1             | 2             |
| A121H005_001 | have boys                  | 有男孩       | 1    | 用户属性 | 5          | 孩子性别   |            |          | 1             | 2             |
| A121H005_002 | have girls                 | 有女孩       | 2    | 用户属性 | 5          | 孩子性别   |            |          | 1             | 2             |
| A121H005_003 | have boys and girls        | 有男孩和女孩 | 3    | 用户属性 | 5          | 孩子性别   |            |          | 1             | 2             |
| A220H006_001 | register date              | 注册日期     | 1    | 用户属性 | 6          | 注册日期   |            |          | 2             | 2             |
| A121H007_001 | cell phone hign price      | 高           | 1    | 用户属性 | 7          | 手机品牌   |            |          | 1             | 2             |
| A121H007_002 | cell phone middle price    | 中           | 2    | 用户属性 | 7          | 手机品牌   |            |          | 1             | 2             |
| A121H007_003 | cell phone low price       | 低           | 3    | 用户属性 | 7          | 手机品牌   |            |          | 1             | 2             |
| A111H008_001 | important value user       | 重要价值用户 | 1    | 用户属性 | 8          | RFM        |            |          | 1             | 1             |
| A111H008_002 | important development user | 重要发展用户 | 2    | 用户属性 | 8          | RFM        |            |          | 1             | 1             |
| A111H008_003 | important maintain user    | 重要保持用户 | 3    | 用户属性 | 8          | RFM        |            |          | 1             | 1             |
| A111H008_004 | important detainment user  | 重要挽留用户 | 4    | 用户属性 | 8          | RFM        |            |          | 1             | 1             |
| A111H008_005 | general value user         | 一般价值用户 | 5    | 用户属性 | 8          | RFM        |            |          | 1             | 1             |
| A111H008_006 | general development user   | 一般发展用户 | 6    | 用户属性 | 8          | RFM        |            |          | 1             | 1             |
| A111H008_007 | general maintain user      | 一般保持用户 | 7    | 用户属性 | 8          | RFM        |            |          | 1             | 1             |
| A111H008_008 | general detainment user    | 一般挽留用户 | 8    | 用户属性 | 8          | RFM        |            |          | 1             | 1             |

- 对于相同的以及标签类型，需要判断多个标签之间的关系为互斥关系还是非互斥关系。如在判断性别是，标签之间关系为互斥关系；在判断黑名单时，用户可能既是邮件黑名单，也是短信黑名单，为非互斥关系。

- 对于数值、统计、分类的标签一般只需要和业务方、产品确认好相应的业务含义，开发比较容易；而对于规则类标签，如用户价值度划分(RFM)，如何确定一个用户是重要价值用户，还是一般价值用户，对于用户活跃度：高活跃、低活跃等，需要进行数据调研来进行划分。

#### 用户性别

用户性别可细分为自然性别和购物性别别两种。

- 用户性别是用户实际性别，通过用户注册信息、填写表单等方式获取；
- 购物性别

### 用户行为维度

